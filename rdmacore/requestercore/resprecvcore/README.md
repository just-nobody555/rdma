# RespRecvCore

## 模块功能

RespRecvCore 是一个高层控制模块，用于处理来自网络的响应 Response 数据包。其主要功能包括：

* 接收来自 PacketDeparser 的原始响应包；
* 协调三个子任务线程：
  * Thread\_1：解析响应包，向 OoOStation 请求上下文（CXT）信息；
  * Thread\_2：处理 CXT/MR 响应、与 WQEBuffer 交互获取工作队列条目（WQE），并生成完成队列（CQ）或事件队列（EQ）条目；
  * Thread\_3：处理 MR 响应，驱动 Scatter-Gather 数据写入，并请求删除接收缓冲区中已处理的包；

## 模块架构

<figure><img src="../../../.gitbook/assets/ReqRecvCore   (1).png" alt=""><figcaption></figcaption></figure>

## 模块接口

<table><thead><tr><th width="191">信号名</th><th width="87">方向</th><th width="87">位宽</th><th width="155">对接模块</th><th width="247">说明</th></tr></thead><tbody><tr><td>clk</td><td>input</td><td>1</td><td>全局时钟</td><td>系统主时钟</td></tr><tr><td>rst</td><td>input</td><td>1</td><td>全局复位</td><td>同步复位</td></tr><tr><td>ingress_pkt_valid</td><td>input</td><td>1</td><td>PacketDeparser</td><td>输入响应包有效</td></tr><tr><td>ingress_pkt_head</td><td>input</td><td>488</td><td>PacketDeparser</td><td>包元数据头（含 QP 号、操作码等）</td></tr><tr><td>ingress_pkt_ready</td><td>output</td><td>1</td><td>PacketDeparser</td><td>本模块准备好接收包</td></tr><tr><td>fetch_cxt_ingress_valid</td><td>output</td><td>1</td><td>OoOStation</td><td>请求 CXT 有效</td></tr><tr><td>fetch_cxt_ingress_head</td><td>output</td><td>160</td><td>OoOStation</td><td>CXT 请求头位宽：CXT_CMD_HEAD_WIDTH(128) + INGRESS_COMMON_HEAD_WIDTH(32)</td></tr><tr><td>fetch_cxt_ingress_data</td><td>output</td><td>488</td><td>OoOStation</td><td>CXT 请求数据</td></tr><tr><td>fetch_cxt_ingress_start</td><td>output</td><td>1</td><td>OoOStation</td><td>分段起始标志</td></tr><tr><td>fetch_cxt_ingress_last</td><td>output</td><td>1</td><td>OoOStation</td><td>分段结束标志</td></tr><tr><td>fetch_cxt_ingress_ready</td><td>input</td><td>1</td><td>OoOStation</td><td>OoOStation 准备好接收 CXT 请求</td></tr><tr><td>fetch_cxt_egress_valid</td><td>input</td><td>1</td><td>OoOStation</td><td>CXT 响应有效</td></tr><tr><td>fetch_cxt_egress_head</td><td>input</td><td>672</td><td>OoOStation</td><td>CXT 响应头</td></tr><tr><td>fetch_cxt_egress_data</td><td>input</td><td>488</td><td>OoOStation</td><td>CXT 响应数据位宽：RX_RESP_OOO_CXT_EGRESS_DATA_WIDTH = PKT_META_BUS_WIDTH = 488</td></tr><tr><td>fetch_cxt_egress_start</td><td>input</td><td>1</td><td>OoOStation</td><td>分段起始位</td></tr><tr><td>fetch_cxt_egress_last</td><td>input</td><td>1</td><td>OoOStation</td><td>分段结束位</td></tr><tr><td>fetch_cxt_egress_ready</td><td>output</td><td>1</td><td>OoOStation</td><td>本模块准备好接收 CXT 响应</td></tr><tr><td>fetch_mr_ingress_valid</td><td>output</td><td>1</td><td>OoOStation</td><td>MR 请求有效</td></tr><tr><td>fetch_mr_ingress_head</td><td>output</td><td>224</td><td>OoOStation</td><td>MR 请求头位宽：MR_CMD_HEAD_WIDTH(192) + INGRESS_COMMON_HEAD_WIDTH(32)</td></tr><tr><td>fetch_mr_ingress_data</td><td>output</td><td>352</td><td>OoOStation</td><td>MR 请求数据位宽：RX_RESP_OOO_MR_INGRESS_DATA_WIDTH = 352</td></tr><tr><td>fetch_mr_ingress_start</td><td>output</td><td>1</td><td>OoOStation</td><td>分段起始位</td></tr><tr><td>fetch_mr_ingress_last</td><td>output</td><td>1</td><td>OoOStation</td><td>分段结束位</td></tr><tr><td>fetch_mr_ingress_ready</td><td>input</td><td>1</td><td>OoOStation</td><td>OoOStation 准备好接收 MR 请求</td></tr><tr><td>fetch_mr_egress_valid</td><td>input</td><td>1</td><td>OoOStation</td><td>MR 响应有效</td></tr><tr><td>fetch_mr_egress_head</td><td>input</td><td>256</td><td>OoOStation</td><td>MR 响应头位宽： MR_RESP_DATA_WIDTH(224) + EGRESS_COMMON_HEAD_WIDTH(32)</td></tr><tr><td>fetch_mr_egress_data</td><td>input</td><td>352</td><td>OoOStation</td><td>MR 响应数据</td></tr><tr><td>fetch_mr_egress_start</td><td>input</td><td>1</td><td>OoOStation</td><td>分段起始</td></tr><tr><td>fetch_mr_egress_last</td><td>input</td><td>1</td><td>OoOStation</td><td>分段结束</td></tr><tr><td>fetch_mr_egress_ready</td><td>output</td><td>1</td><td>OoOStation</td><td>本模块准备好接收 MR 响应</td></tr><tr><td>dequeue_req_valid</td><td>output</td><td>1</td><td>WQEBuffer</td><td>请求弹出 WQE有效</td></tr><tr><td>dequeue_req_head</td><td>output</td><td>17</td><td>WQEBuffer</td><td>请求弹出 WQE头</td></tr><tr><td>dequeue_req_ready</td><td>input</td><td>1</td><td>WQEBuffer</td><td>WQEBuffer 准备好接收请求</td></tr><tr><td>dequeue_resp_valid</td><td>input</td><td>1</td><td>WQEBuffer</td><td>WQE 响应有效</td></tr><tr><td>dequeue_resp_head</td><td>input</td><td>17</td><td>WQEBuffer</td><td>QP + Slot 索引</td></tr><tr><td>dequeue_resp_start</td><td>input</td><td>1</td><td>WQEBuffer</td><td>分段开始</td></tr><tr><td>dequeue_resp_last</td><td>input</td><td>1</td><td>WQEBuffer</td><td>分段结束</td></tr><tr><td>dequeue_resp_ready</td><td>output</td><td>1</td><td>WQEBuffer</td><td>本模块准备好接收 WQE</td></tr><tr><td>dequeue_resp_data</td><td>input</td><td>256</td><td>WQEBuffer</td><td>实际 WQE 数据</td></tr><tr><td>cq_req_valid</td><td>output</td><td>1</td><td>CompletionQueueMgt</td><td>CQ 写请求有效</td></tr><tr><td>cq_req_head</td><td>output</td><td>64</td><td>CompletionQueueMgt</td><td>CQ 请求头</td></tr><tr><td>cq_req_ready</td><td>input</td><td>1</td><td>CompletionQueueMgt</td><td>CQ Manager 准备好接收</td></tr><tr><td>cq_resp_valid</td><td>input</td><td>1</td><td>CompletionQueueMgt</td><td>CQ 响应有效</td></tr><tr><td>cq_resp_head</td><td>input</td><td>96</td><td>CompletionQueueMgt</td><td>CQ 响应头</td></tr><tr><td>cq_resp_ready</td><td>output</td><td>1</td><td>CompletionQueueMgt</td><td>本模块准备好接收 CQ 响应</td></tr><tr><td>eq_req_valid</td><td>output</td><td>1</td><td>EventQueueMgt</td><td>EQ 写请求有效</td></tr><tr><td>eq_req_head</td><td>output</td><td>64</td><td>EventQueueMgt</td><td>EQ 请求头</td></tr><tr><td>eq_req_ready</td><td>input</td><td>1</td><td>EventQueueMgt</td><td>EQ Manager 准备好接收</td></tr><tr><td>eq_resp_valid</td><td>input</td><td>1</td><td>EventQueueMgt</td><td>EQ 响应有效</td></tr><tr><td>eq_resp_head</td><td>input</td><td>96</td><td>EventQueueMgt</td><td>EQ 响应头</td></tr><tr><td>eq_resp_ready</td><td>output</td><td>1</td><td>EventQueueMgt</td><td>本模块准备好接收 EQ 响应</td></tr><tr><td>scatter_req_wen</td><td>output</td><td>1</td><td>DMA内存读写模块</td><td>Scatter 地址/长度写使能</td></tr><tr><td>scatter_req_din</td><td>output</td><td>128</td><td>DMA内存读写模块</td><td>Scatter 请求包数据</td></tr><tr><td>scatter_req_prog_full</td><td>input</td><td>1</td><td>DMA内存读写模块</td><td>请求 FIFO 满</td></tr><tr><td>scatter_data_wen</td><td>output</td><td>1</td><td>DMA内存读写模块</td><td>数据写使能</td></tr><tr><td>scatter_data_din</td><td>output</td><td>512</td><td>DMA内存读写模块</td><td>Scatter 响应实际数据内容</td></tr><tr><td>scatter_data_prog_full</td><td>input</td><td>1</td><td>DMA内存读写模块</td><td>数据 FIFO 满</td></tr><tr><td>delete_req_valid</td><td>output</td><td>1</td><td>PacketBuffer</td><td>删除请求有效</td></tr><tr><td>delete_req_head</td><td>output</td><td>24</td><td>PacketBuffer</td><td>删除请求头</td></tr><tr><td>delete_req_ready</td><td>input</td><td>1</td><td>PacketBuffer</td><td>PacketBuffer 准备好接收</td></tr><tr><td>delete_resp_valid</td><td>input</td><td>1</td><td>PacketBuffer</td><td>删除响应有效</td></tr><tr><td>delete_resp_start</td><td>input</td><td>1</td><td>PacketBuffer</td><td>分段开始</td></tr><tr><td>delete_resp_last</td><td>input</td><td>1</td><td>PacketBuffer</td><td>分段结束</td></tr><tr><td>delete_resp_data</td><td>input</td><td>512</td><td>PacketBuffer</td><td>返回被删除的 slot 信息</td></tr><tr><td>delete_resp_ready</td><td>output</td><td>1</td><td>PacketBuffer</td><td>本模块准备好接收删除响应</td></tr></tbody></table>

